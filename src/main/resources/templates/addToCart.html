<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head >
    <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-5.3.0-alpha1-dist/css/bootstrap.min.css}"/>
  <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-5.3.0-alpha1-dist/css/bootstrap.css}"/>
  <link rel="stylesheet" type="text/css" th:href="@{/css/addToCart.css}">
  <link rel="shortcut icon" type="image/x-icon" th:href="@{/images/newIcon.ico}">
  <title>AniMall</title>

  <style>
    /*navbar*/

    .navbar{
      box-shadow: 0 2px 5px 2px rgb(0,0,0,0.1);
    }
    .navbar-brand img{
      width:30px;
    }
    .navbar-brand span{
      letter-spacing: 2px;
      font-family: var(--lg-font);
    }
    .nav-link:hover{
      color:var(--green)!important;
    }
    .nav-item--active{
      background-color: #ffffff;
    }
    .nav-item{
      border-bottom: 0.5px solid rgba(0,0,0,0.05);

    }
    @media(min-width: 992px){
      .nav-item{
        border-bottom: none;
      }

    }
    @media (min-width: 1025px) {
      .h-custom {
        height: 100vh !important;
      }
    }

    .card-registration .select-input.form-control[readonly]:not([disabled]) {
      font-size: 1rem;
      line-height: 2.15;
      padding-left: .75em;
      padding-right: .75em;
    }

    .card-registration .select-arrow {
      top: 13px;
    }

    .bg-grey {
      background-color: #eae8e8;
    }

    @media (min-width: 992px) {
      .card-registration-2 .bg-grey {
        border-top-right-radius: 16px;
        border-bottom-right-radius: 16px;
      }
    }

    @media (max-width: 991px) {
      .card-registration-2 .bg-grey {
        border-bottom-left-radius: 16px;
        border-bottom-right-radius: 16px;
      }
    }
  </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>


<section class="h-100 h-custom" style="background-color: #d2c9ff;">
  <div class="container py-5 h-100" style="padding-top: 80px!important">
    <div class="row d-flex justify-content-center align-items-start h-100">
      <div class="col-lg-8">
        <div class="card card-registration card-registration-2" style="border-radius: 15px;">
          <div class="card-body p-0" style="height: 675px;">
            <div class="p-5">
              <div class="d-flex justify-content-between align-items-center mb-5">
                <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>
                <h6 class="mb-0 text-muted" th:text="${cartItems.size()}"></h6>
              </div>
              <hr class="my-4">

              <!-- Loop through cart items and display details -->
              <div th:each="cartItem : ${cartItems}" th:if="${cartItem.pet != null}">
                <!-- Cart item details -->
                <div class="row mb-4 d-flex justify-content-between align-items-center">
                  <div class="col-md-2 col-lg-2 col-xl-2">
                    <img th:src="'data:image/png;base64,' + ${cartItem.pet.imageBase64}" class="img-fluid rounded-3" th:alt="${cartItem.pet.getPetname()}" width="100" height="100" />
                  </div>
                  <div class="col-md-3 col-lg-3 col-xl-3">
                    <h6 class="text-muted">Shirt</h6>
                    <h6 class="text-black mb-0" th:text="${cartItem.pet.getPetname()}"></h6>
                  </div>
                  <div class="col-md-3 col-lg-3 col-xl-2 d-flex">
                    <form th:action="@{/cart/updateQuantity/{id}(id=${cartItem.id})}" th:if="${cartItem.quantity > 0}" method="post">
                      <button class="btn btn-link px-2" type="submit" onclick="updateQuantity(-1, [[${cartItem.id}]])">
                        <i class="fas fa-minus"></i>
                      </button>
                    </form>
                    <div class="form-outline">
                      <input id="'quantityInput_'+${cartItem.id}" min="0" name="'quantity_'+${cartItem.id}" th:value="${cartItem.quantity}" type="number" class="form-control form-control-sm" />
                      <label class="form-label" for="'quantityInput_'+${cartItem.id}">Quantity</label>
                    </div>
                    <form th:action="@{/cart/updateQuantity/{id}(id=${cartItem.id})}" method="post">
                      <button class="btn btn-link px-2" type="submit" onclick="updateQuantity(1, [[${cartItem.id}]])">
                        <i class="fas fa-plus"></i>
                      </button>
                    </form>
                  </div>
                  <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
                    <h6 class="mb-0" th:text="'Rs. ' + ${cartItem.pet.getPrice()}"></h6>
                  </div>
                  <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                    <form th:action="@{/cart/remove/{id}(id=${cartItem.id})}" method="post">
                      <button type="submit" class="btn btn-link text-muted"><i class="fas fa-times"></i></button>
                    </form>
                  </div>
                </div>
                <hr class="my-4">
              </div>
              <!-- Loop end -->

              <div class="pt-5">
                <h6 class="mb-0"><a href="#!" class="text-body"><i class="fas fa-long-arrow-alt-left me-2"></i>Back to shop</a></h6>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Summary Section -->
      <div class="col-lg-4 bg-grey" style="border-radius: 12px;height: 675px;">
        <div class="p-1" style="padding: 8px!important;">
          <h3 class="fw-bold mt-2 pt-1">Summary</h3>
          <div class="d-flex justify-content-between mb-4">
            <h5 class="" th:text="'Items ' + ${cartItems.size()}"></h5>
            <h5 th:text="'Rs. ' + ${total}">Rs.132.00</h5>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="">Shipping Price</h5>
            <select class="select">
              <option value="1">Standard-Delivery- Rs.150.00</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
              <option value="4">Four</option>
            </select>
          </div>
          <hr class="my-2">

          <div class="d-flex justify-content-between">
            <h5 class="text-uppercase">Total price</h5>
            <h5 th:text="'â‚¬ ' + ${total}">Rs. 137.00</h5>
          </div>
          <hr class="my-2">

          <h3 class="fw-bold mt-1 pt-1">Shipping Details</h3>

          <!-- Shipping Details Form -->
          <form  th:action="@{/checkout}" th:object="${checkout}" th:method="post" >
<!--            <input type="hidden" name="status" value="Pending" />-->

            <!-- Hidden fields for pet_id, user_id, and total -->
<!--            <input type="hidden" name="pet_id" th:value="${cartItems[0].pet.id}" />-->
            <input type="hidden" name="total" th:value="${total}" />

            <div class="mb-2">
              <label for="shippingLastName" class="form-label">Your Name</label>
             <input type="text" class="form-control" id="shippingLastName" name="shippingLastName" required />
            </div>

            <!-- Shipping Phone -->
            <div class="mb-2">
              <label for="shippingPhone" class="form-label">Phone</label>
              <input type="text" class="form-control" id="shippingPhone" name="shippingPhone" required />
            </div>

            <!-- Shipping Address -->
            <div class="mb-2">
              <label for="shippingAddress" class="form-label">Address</label>
              <input type="text" class="form-control" id="shippingAddress" name="shippingAddress" required />
            </div>

            <!-- Payment upload image -->
            <div class="mb-2">
              <label for="payment" class="form-label">Payment</label>
              <input type="file" class="form-control" id="payment" name="payment" required />
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-dark btn-block btn-lg" data-mdb-ripple-color="dark">Proceed to Checkout</button>
          </form>

        </div>
      </div>

    </div>
  </div>
</section>



<script th:inline="javascript">
  function updateQuantity(change, cartItemId) {
    var quantityInput = document.getElementById('quantityInput_' + cartItemId);
    if (quantityInput) { // Check if the element is found
      var currentQuantity = parseInt(quantityInput.value);
      var newQuantity = currentQuantity + change;
      if (newQuantity >= 0) {
        quantityInput.value = newQuantity;
      }
    }
  }
</script>


</body>
</html>